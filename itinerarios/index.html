<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itinerarios Educativos - IES El Majuelo (Edad)</title>
    
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <style>
        /* ESTILOS GENERALES */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            overflow: hidden; 
        }

        /* CABECERA */
        #header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e0e0e0;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-sizing: border-box;
            flex-wrap: wrap;
        }

        .titles { max-width: 50%; }

        h1 { margin: 0; font-size: 24px; color: #2c3e50; }
        h2 { margin: 5px 0 0 0; font-size: 14px; color: #7f8c8d; font-weight: normal; }
        .version-tag { 
            display: inline-block; background: #e3f2fd; color: #1565c0; 
            padding: 2px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; margin-left: 10px;
            border: 1px solid #90caf9;
        }

        /* LEYENDA */
        .legend { display: flex; gap: 10px; flex-wrap: wrap; font-size: 12px; }
        .legend-item { display: flex; align-items: center; }
        .dot { width: 10px; height: 10px; border-radius: 3px; margin-right: 5px; border: 1px solid rgba(0,0,0,0.1); }

        .dot.eso { background-color: #E3F2FD; border-color: #2196F3; }
        .dot.bach { background-color: #E8F5E9; border-color: #4CAF50; }
        .dot.fp { background-color: #FFF3E0; border-color: #FF9800; }
        .dot.adultos { background-color: #F3E5F5; border-color: #9C27B0; }
        .dot.prueba { background-color: #F5F5F5; border-color: #9E9E9E; }
        .dot.pau { background-color: #FFEBEE; border-color: #EF5350; }
        .dot.salida { background-color: #ECEFF1; border-color: #607D8B; }
        .dot.externo { background-color: #f5f5f5; border-color: #999; border-style: dashed; }

        /* MAPA */
        #mynetwork { width: 100%; height: 100vh; background-color: #ffffff; }

        /* CONTROLES INFERIORES */
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 10;
            display: flex;
            gap: 10px;
        }

        button {
            background: white; border: 1px solid #ccc; padding: 8px 15px;
            border-radius: 5px; cursor: pointer; font-weight: bold; color: #555;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: all 0.2s;
        }
        button:hover { background: #f5f5f5; color: #000; }

        /* PANEL DE FILTRO (Derecha Arriba) */
        #filter-panel {
            position: absolute;
            top: 90px;
            right: 20px;
            width: 250px;
            background: rgba(255, 255, 255, 0.98);
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 15;
            font-family: 'Segoe UI', sans-serif;
        }
        #filter-panel h3 { margin: 0 0 10px 0; font-size: 14px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        
        select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: #fff;
            font-size: 14px;
            color: #333;
            cursor: pointer;
            margin-bottom: 10px;
        }
        select:focus { outline: none; border-color: #2196F3; }

        /* Estilos para el filtro de edad */
        .age-control {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
        }
        .checkbox-wrapper input { margin-right: 8px; cursor: pointer; }
        .checkbox-wrapper label { font-size: 13px; color: #333; cursor: pointer; font-weight: bold;}
        
        .slider-wrapper {
            opacity: 0.5;
            transition: opacity 0.3s;
            pointer-events: none; /* Desactivado por defecto */
        }
        .slider-wrapper.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        input[type=range] {
            width: 100%;
            margin: 5px 0;
        }
        .age-display {
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 5px;
        }

        /* PANEL DE CONFIGURACI√ìN DE ZONA (Debajo del filtro) */
        #zone-config {
            position: absolute;
            top: 320px; /* Ajustado para estar debajo del filtro m√°s alto */
            right: 20px;
            width: 250px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 14;
            font-size: 13px;
            display: none; 
        }
        .config-toggle {
            font-size: 11px; color: #999; text-align: right; cursor: pointer; margin-top: 5px; text-decoration: underline;
        }
        #zone-config h3 { margin: 0 0 10px 0; font-size: 14px; color: #333; border-bottom: 1px solid #eee; padding-bottom: 5px; }
        .input-group { margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .input-group label { color: #666; }
        .input-group input { width: 60px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; }
        
        @media (max-width: 768px) {
            #header { flex-direction: column; align-items: flex-start; }
            .titles { max-width: 100%; margin-bottom: 10px; }
            .legend { width: 100%; }
            #filter-panel { top: auto; bottom: 80px; right: 20px; width: 200px; }
        }
    </style>
</head>
<body>

    <div id="header">
        <div class="titles">
            <h1>Itinerarios Educativos ‚Äì IES El Majuelo <span class="version-tag">EDAD + FILTROS</span></h1>
            <h2>Sistema completo de orientaci√≥n. Usa el filtro de edad para ver opciones personalizadas.</h2>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="dot eso"></div> ESO</div>
            <div class="legend-item"><div class="dot bach"></div> Bachillerato</div>
            <div class="legend-item"><div class="dot fp"></div> FP</div>
            <div class="legend-item"><div class="dot adultos"></div> Adultos</div>
            <div class="legend-item"><div class="dot prueba"></div> Pruebas</div>
            <div class="legend-item"><div class="dot pau"></div> PAU</div>
            <div class="legend-item"><div class="dot externo"></div> Otro Centro</div>
        </div>
    </div>

    <!-- Panel de Filtro -->
    <div id="filter-panel">
        <h3>üîç Filtrar por Ense√±anza</h3>
        <select id="nodeFilter" onchange="updateAllFilters()">
            <option value="all">üìç Ver Mapa Completo</option>
            <option disabled>‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</option>
            <option value="1">üéì ESO</option>
            <option value="2">üìö Bachillerato (Ciencias/Hum)</option>
            <option value="3">üõ†Ô∏è FP B√°sica</option>
            <option value="4">üîß FP Grado Medio</option>
            <option value="7">‚öôÔ∏è FP Grado Superior</option>
            <option value="5">üåô ESA Adultos</option>
            <option value="13">üìñ Bachillerato Adultos</option>
        </select>

        <div class="age-control">
            <div class="checkbox-wrapper">
                <input type="checkbox" id="ageFilterCheck" onchange="toggleAgeFilter()">
                <label for="ageFilterCheck">Filtrar por Edad del Alumno</label>
            </div>
            <div id="ageSliderWrapper" class="slider-wrapper">
                <div class="age-display"><span id="ageValue">16</span> a√±os</div>
                <input type="range" id="ageSlider" min="12" max="26" value="16" oninput="updateAgeDisplay(); updateAllFilters()">
                <div style="display: flex; justify-content: space-between; font-size: 10px; color: #666;">
                    <span>12</span>
                    <span>19</span>
                    <span>26+</span>
                </div>
            </div>
        </div>

        <div class="config-toggle" onclick="toggleZoneConfig()">Editar zona punteada</div>
    </div>

    <!-- Panel para mover el rect√°ngulo (Oculto por defecto) -->
    <div id="zone-config">
        <h3>Zona IES El Majuelo</h3>
        <div class="input-group">
            <label>Posici√≥n X:</label>
            <input type="number" id="rectX" value="-480" onchange="updateZone()">
        </div>
        <div class="input-group">
            <label>Posici√≥n Y:</label>
            <input type="number" id="rectY" value="-330" onchange="updateZone()">
        </div>
        <div class="input-group">
            <label>Ancho:</label>
            <input type="number" id="rectW" value="790" onchange="updateZone()">
        </div>
        <div class="input-group">
            <label>Alto:</label>
            <input type="number" id="rectH" value="600" onchange="updateZone()">
        </div>
        <div style="font-size: 11px; color: #999; margin-top: 5px;">Ajusta el recuadro de la oferta interna.</div>
    </div>

    <div id="mynetwork"></div>

    <div class="controls">
        <button onclick="restorePositions()">Restaurar Nodos</button>
        <button onclick="fitGraph()">Centrar Mapa</button>
    </div>

    <script type="text/javascript">
        
        // --- VARIABLES DE LA ZONA (RECT√ÅNGULO) ---
        let zone = {
            x: -480,
            y: -330,
            w: 790,
            h: 600
        };

        // --- DATOS ORIGINALES CON EDADES ---
        // minAge: Edad m√≠nima habitual de acceso
        // maxAge: Edad m√°xima habitual (si no se define, es 99)
        const nodesData = [
            // --- Nivel 0 ---
            { id: 1, label: 'E.S.O.\n(Educaci√≥n Secundaria Obligatoria)', group: 'eso', x: 0, y: -300, minAge: 12, maxAge: 17 },

            // --- Nivel 1 ---
            { id: 5, label: 'ESA\n(Adultos)', group: 'adultos', x: -400, y: -250, minAge: 18 }, 
            { id: 6, label: 'Prueba Libre\nESO', group: 'prueba', x: -400, y: -150, minAge: 18 },
            { id: 3, label: 'F.P. B√°sica', group: 'fp', x: -100, y: -150, minAge: 15, maxAge: 19 },

            // --- BACHILLERATO (Interno) ---
            { 
                id: 2, 
                label: 'Bachillerato\n(Ciencias y Humanidades)', 
                group: 'bach', 
                x: 200, 
                y: -100,
                minAge: 16, maxAge: 20
            },

            // --- EXTERNOS (Derecha) ---
            { 
                id: 14, label: 'Bachillerato ARTES\n(En otro centro)', group: 'externo', 
                x: 450, y: -100, shape: 'box', font: { color: '#666' }, minAge: 16, maxAge: 20
            },
            { 
                id: 16, label: 'Grado Medio\n(Otros Centros)', group: 'externo', 
                x: 450, y: 50, shape: 'box', font: { color: '#666' }, minAge: 16
            },
            { 
                id: 17, label: 'Grado Superior\n(Otros Centros)', group: 'externo', 
                x: 450, y: 200, shape: 'box', font: { color: '#666' }, minAge: 18
            },

            // Bachillerato Adultos (Interno)
            { id: 13, label: 'Bachillerato\n(Adultos)', group: 'adultos', x: -400, y: -50, minAge: 18 },

            // --- Nivel 2 ---
            { id: 10, label: 'Prueba Acceso\na Grado Medio (+17)', group: 'prueba', x: -400, y: 50, minAge: 17 },
            { id: 4, label: 'Grado Medio\n(Ciclo Formativo)', group: 'fp', x: -50, y: 50, minAge: 16 },

            // --- NUEVO NODO: PRUEBA LIBRE BACHILLERATO ---
            { id: 18, label: 'Prueba Libre\nBachillerato (+20)', group: 'prueba', x: -400, y: 125, minAge: 20 },

            // --- PAU (Nodo Intermedio) ---
            { 
                id: 15, 
                label: 'PAU / EBAU\n(Selectividad)', 
                group: 'pau', 
                x: 250, 
                y: 200,
                minAge: 17
            },

            // --- Nivel 3 ---
            { id: 11, label: 'Prueba Acceso\na Grado Superior (+19)', group: 'prueba', x: -400, y: 200, minAge: 19 },
            { id: 7, label: 'Grado Superior\n(Ciclo Formativo)', group: 'fp', x: 50, y: 200, minAge: 18 },

            // --- Nivel 4 (Salidas) ---
            { id: 12, label: 'Acceso Universidad\nMayores 25', group: 'prueba', x: 250, y: 350, minAge: 25 },
            { id: 9, label: 'MUNDO LABORAL\n(Empleo)', group: 'salida', x: -150, y: 350, minAge: 16 },
            { id: 8, label: 'UNIVERSIDAD\n(Grado)', group: 'salida', x: 250, y: 450, minAge: 18 },
        ];

        const edgesData = [
            // Desde ESO
            { from: 1, to: 2, label: 'T√≠tulo ESO' },
            { from: 1, to: 4, label: 'T√≠tulo ESO' },
            { from: 1, to: 3, label: 'No titula' },
            { from: 1, to: 5, label: '+18 a√±os' },
            { from: 1, to: 6, label: '+18 a√±os' },
            { from: 1, to: 9, label: '+16 a√±os', dashes: true, color: {color:'#B0BEC5'} },
            
            // CONEXIONES A EXTERNOS DESDE ESO
            { from: 1, to: 14, label: 'T√≠tulo ESO', dashes: true, color: { color: '#999'} },
            { from: 1, to: 16, label: 'T√≠tulo ESO', dashes: true, color: { color: '#999'} },

            // FPB y Adultos ESO
            { from: 3, to: 4, label: 'T√≠tulo' },
            { from: 3, to: 16, label: 'T√≠tulo', dashes: true, color: { color: '#999'} },
            { from: 3, to: 9, label: '', dashes: true, color: {color:'#B0BEC5'} },

            { from: 5, to: 2, label: 'T√≠tulo ESO' }, 
            { from: 5, to: 13, label: 'T√≠tulo ESO' }, 
            { from: 5, to: 4, label: 'T√≠tulo ESO' },
            { from: 5, to: 16, label: 'T√≠tulo ESO', dashes: true, color: { color: '#999'} },
            { from: 5, to: 9, label: '', dashes: true, color: {color:'#B0BEC5'} },

            { from: 6, to: 2, label: 'T√≠tulo obtenido' },
            { from: 6, to: 13, label: 'T√≠tulo obtenido' },
            { from: 6, to: 4, label: 'T√≠tulo obtenido' },
            { from: 6, to: 9, label: '', dashes: true, color: {color:'#B0BEC5'} },

            // Pruebas Acceso y GM
            { from: 10, to: 4, label: 'Prueba +17' },
            { from: 10, to: 16, label: 'Prueba +17', dashes: true, color: { color: '#999'} },

            // Desde GM Interno
            { from: 4, to: 7, label: 'T√≠tulo T√©cnico' },
            { from: 4, to: 17, label: 'T√≠tulo T√©cnico', dashes: true, color: { color: '#999'} },
            { from: 4, to: 9, label: 'Inserci√≥n' },

            // Desde GM Externo
            { from: 16, to: 17, label: 'T√≠tulo T√©cnico', dashes: true, color: { color: '#999'} },
            { from: 16, to: 7, label: 'T√≠tulo T√©cnico', dashes: true, color: { color: '#999'} }, 

            // Bachillerato (Normal)
            { from: 2, to: 15, label: 'T√≠tulo Bachiller' },
            { from: 2, to: 7, label: 'T√≠tulo (Sin PAU)' },
            { from: 2, to: 17, label: 'T√≠tulo (Sin PAU)', dashes: true, color: { color: '#999'} },
            { from: 2, to: 9, label: '', dashes: true, color: {color:'#ccc'} },

            // Bachillerato (Adultos)
            { from: 13, to: 15, label: 'T√≠tulo Bachiller' },
            { from: 13, to: 7, label: 'T√≠tulo' },
            { from: 13, to: 9, label: '', dashes: true, color: {color:'#B0BEC5'} },

            // Bachillerato Artes (Externo)
            { from: 14, to: 15, label: 'T√≠tulo', dashes: true, color: { color: '#999'} }, 
            { from: 14, to: 17, label: 'T√≠tulo', dashes: true, color: { color: '#999'} },

            // Prueba Libre Bachillerato
            { from: 18, to: 15, label: 'T√≠tulo' },
            { from: 18, to: 7, label: 'T√≠tulo' },
            { from: 18, to: 17, label: 'T√≠tulo', dashes: true, color: { color: '#999'} },

            // PAU a Universidad
            { from: 15, to: 8, label: 'Nota Admisi√≥n' },

            // GS y Accesos
            { from: 11, to: 7, label: 'Prueba +19' },
            { from: 11, to: 17, label: 'Prueba +19', dashes: true, color: { color: '#999'} },

            { from: 7, to: 8, label: 'Nota Media' },
            { from: 7, to: 15, label: 'Subir Nota', dashes: true },
            { from: 7, to: 9, label: 'Inserci√≥n' },
            
            { from: 17, to: 8, label: 'Nota Media', dashes: true, color: { color: '#999'} }, 
            { from: 17, to: 15, label: 'Subir Nota', dashes: true, color: { color: '#999'} },

            // Uni lateral
            { from: 12, to: 8, label: 'Prueba Acceso' }
        ];

        // Definici√≥n de grupos
        const groups = {
            eso: { color: { background: '#E3F2FD', border: '#2196F3' }, font: { color: '#0d47a1' } },
            bach: { color: { background: '#E8F5E9', border: '#4CAF50' }, font: { color: '#1b5e20' } },
            fp: { color: { background: '#FFF3E0', border: '#FF9800' }, font: { color: '#e65100' } },
            adultos: { color: { background: '#F3E5F5', border: '#9C27B0' }, font: { color: '#4a148c' } },
            prueba: { color: { background: '#F5F5F5', border: '#9E9E9E' }, font: { color: '#616161' } },
            salida: { color: { background: '#ECEFF1', border: '#607D8B' }, font: { color: '#37474f' } },
            pau: { color: { background: '#FFEBEE', border: '#EF5350' }, font: { color: '#B71C1C' } },
            externo: { 
                color: { background: '#fafafa', border: '#999999' }, 
                shapeProperties: { borderDashes: [5, 5] }, 
                font: { color: '#666' } 
            }
        };

        const container = document.getElementById('mynetwork');
        
        const nodes = new vis.DataSet();
        const edges = new vis.DataSet();
        const data = { nodes: nodes, edges: edges };

        const options = {
            nodes: {
                shape: 'box',
                margin: 10,
                borderWidth: 2,
                shadow: true,
                font: { size: 16, multi: true },
                widthConstraint: { maximum: 200 }
            },
            edges: {
                arrows: { to: { enabled: true, type: 'arrow' } },
                color: { color: '#546E7A' },
                font: { size: 11, align: 'horizontal', background: 'rgba(255, 255, 255, 0.9)', strokeWidth: 0 },
                smooth: { enabled: true, type: 'cubicBezier', roundness: 0.5 }
            },
            physics: { enabled: false }, 
            layout: { hierarchical: { enabled: false } }, 
            interaction: { dragNodes: true, zoomView: true, dragView: true, hover: true }
        };

        const network = new vis.Network(container, data, options);

        // --- L√ìGICA DE DIBUJADO DE ZONA ---
        let isFullMap = true;

        network.on("beforeDrawing", function (ctx) {
            if (!isFullMap) return; 

            ctx.save();
            ctx.setLineDash([10, 10]);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#2196F3';
            ctx.fillStyle = 'rgba(33, 150, 243, 0.03)';

            if (ctx.roundRect) {
                ctx.beginPath();
                ctx.roundRect(zone.x, zone.y, zone.w, zone.h, 20);
                ctx.stroke();
                ctx.fill();
            } else {
                ctx.beginPath();
                ctx.rect(zone.x, zone.y, zone.w, zone.h);
                ctx.stroke();
                ctx.fill();
            }

            ctx.font = "bold 16px Arial";
            ctx.fillStyle = "#2196F3";
            ctx.textAlign = "left";
            ctx.fillText("Oferta Educativa IES El Majuelo", zone.x + 20, zone.y + 30);
            ctx.restore();
        });

        // --- GESTI√ìN DE FILTROS ---

        function toggleAgeFilter() {
            const checkBox = document.getElementById('ageFilterCheck');
            const sliderWrapper = document.getElementById('ageSliderWrapper');
            
            if (checkBox.checked) {
                sliderWrapper.classList.add('active');
            } else {
                sliderWrapper.classList.remove('active');
            }
            updateAllFilters();
        }

        function updateAgeDisplay() {
            const age = document.getElementById('ageSlider').value;
            document.getElementById('ageValue').innerText = age;
        }

        // Funci√≥n Maestra de Filtros: Combina Dropdown + Edad
        function updateAllFilters() {
            const teachSelect = document.getElementById('nodeFilter');
            const ageCheck = document.getElementById('ageFilterCheck');
            const ageSlider = document.getElementById('ageSlider');
            
            const teachValue = teachSelect.value;
            const useAge = ageCheck.checked;
            const currentAge = parseInt(ageSlider.value);

            nodes.clear();
            edges.clear();

            // 1. Determinamos qu√© nodos pasan el filtro de ENSE√ëANZA
            let nodesToShowByTeaching = new Set();
            
            if (teachValue === 'all') {
                isFullMap = true;
                // Todos los nodos son candidatos
                nodesData.forEach(n => nodesToShowByTeaching.add(n.id));
            } else {
                isFullMap = false;
                const centerId = parseInt(teachValue);
                nodesToShowByTeaching.add(centerId);
                
                // A√±adir vecinos directos
                edgesData.forEach(e => {
                    if (e.from === centerId || e.to === centerId) {
                        nodesToShowByTeaching.add(e.from);
                        nodesToShowByTeaching.add(e.to);
                    }
                });
            }

            // 2. Determinamos qu√© nodos pasan el filtro de EDAD (si est√° activo)
            let finalNodes = [];
            
            if (useAge) {
                // Si usamos edad, filtramos los que ya pasaron el filtro de ense√±anza
                isFullMap = false; // Ocultamos la zona azul si filtramos por edad para evitar confusi√≥n
                
                finalNodes = nodesData.filter(n => {
                    // Debe estar en la lista de ense√±anza permitida
                    if (!nodesToShowByTeaching.has(n.id)) return false;

                    // L√≥gica de Edad
                    const min = n.minAge || 0;
                    const max = n.maxAge || 99;
                    return currentAge >= min && currentAge <= max;
                });
            } else {
                // Si no usamos edad, mostramos todos los que pasaron el filtro de ense√±anza
                finalNodes = nodesData.filter(n => nodesToShowByTeaching.has(n.id));
                // Si el filtro de ense√±anza es 'all' y no hay edad, restauramos isFullMap a true arriba
            }

            // 3. Filtramos las conexiones
            // Solo mostramos flechas si ambos nodos (origen y destino) est√°n visibles
            const visibleNodeIds = new Set(finalNodes.map(n => n.id));
            const finalEdges = edgesData.filter(e => visibleNodeIds.has(e.from) && visibleNodeIds.has(e.to));

            // Actualizamos el grafo
            nodes.add(finalNodes);
            edges.add(finalEdges);
            
            // Si el cambio fue dr√°stico, ajustamos c√°mara
            // network.fit({ animation: { duration: 800 } }); 
            // Comentado para evitar saltos constantes al mover el slider, 
            // pero √∫til si cambiamos de ense√±anza. Lo haremos condicional:
            
        }

        // --- FUNCIONES DE INTERFAZ ---
        function updateZone() {
            zone.x = parseInt(document.getElementById('rectX').value);
            zone.y = parseInt(document.getElementById('rectY').value);
            zone.w = parseInt(document.getElementById('rectW').value);
            zone.h = parseInt(document.getElementById('rectH').value);
            network.redraw();
        }

        function toggleZoneConfig() {
            const panel = document.getElementById('zone-config');
            panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        }

        // --- INICIO ---
        updateAllFilters(); 

        function fitGraph() {
            network.fit({ animation: { duration: 800 } });
        }

        function restorePositions() {
            const currentNodes = nodes.get();
            currentNodes.forEach(n => {
                const original = nodesData.find(od => od.id === n.id);
                if (original) {
                    nodes.update({id: n.id, x: original.x, y: original.y});
                }
            });
            network.fit({ animation: { duration: 800 } });
        }

    </script>
</body>
</html>
